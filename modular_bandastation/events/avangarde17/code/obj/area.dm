// MARK: Area
// Зоны Авангарда
// Возможно переделать из-за наследования
/area/awaymission/avangarde17
	name = "Авангард-17"
	icon_state = "awaycontent1"
	requires_power = TRUE
	static_lighting = TRUE

// Зоны улицы
// Альфа 120, подумать как сделать тени на стенки
/area/awaymission/avangarde17/outside
	name = "Лес"
	icon_state = "awaycontent2"
	base_lighting_alpha = 120
	requires_power = FALSE

/area/awaymission/avangarde17/outside/mountains
	name = "Горы"
	icon_state = "awaycontent3"
	requires_power = FALSE
	base_lighting_alpha = 120

/area/awaymission/avangarde17/outside/city
	name = "ПГТ \"Зорька\""
	icon_state = "awaycontent4"
	requires_power = FALSE
	base_lighting_alpha = 120

/area/awaymission/avangarde17/outside/base
	name = "Военная База \"ГРК-4\""
	icon_state = "awaycontent5"
	requires_power = FALSE
	base_lighting_alpha = 120

/area/awaymission/avangarde17/outside/ruin
	name = "Руины"
	icon_state = "awaycontent6"
	requires_power = FALSE
	base_lighting_alpha = 120

/area/awaymission/avangarde17/outside/roofs
	name = "Крыша"
	icon_state = "awaycontent7"
	requires_power = FALSE
	base_lighting_alpha = 120

// Зоны пещер и помещений
/area/awaymission/avangarde17/inside
	name = "Пещеры"
	icon_state = "awaycontent8"

/area/awaymission/avangarde17/inside/vedi
	name = "Гиперборея"
	icon_state = "awaycontent9"

/area/awaymission/avangarde17/inside/mine
	name = "Шахта"
	icon_state = "awaycontent10"

/area/awaymission/avangarde17/inside/temple
	name = "Храм"
	icon_state = "awaycontent11"

/area/awaymission/avangarde17/inside/bar
	name = "Рюмочная \"Красная Звезда\""
	icon_state = "awaycontent12"

/area/awaymission/avangarde17/inside/shop_1
	name = "Гастроном \"Козерог\""
	icon_state = "awaycontent13"

/area/awaymission/avangarde17/inside/shop_2
	name = "Промтовары \"Михалыч\""
	icon_state = "awaycontent14"

/area/awaymission/avangarde17/inside/hangar
	name = "Склад"
	icon_state = "awaycontent15"

/area/awaymission/avangarde17/inside/hangar/second_floor
	name = "Склад - Второй Этаж"
	icon_state = "awaycontent16"

/area/awaymission/avangarde17/inside/hangar/cabinet
	name = "Склад - Кабинет"
	icon_state = "awaycontent16"

/area/awaymission/avangarde17/inside/miner
	name = "Бытовка"
	icon_state = "awaycontent17"

/area/awaymission/avangarde17/inside/miner/second_floor
	name = "Бытовка - Второй Этаж"
	icon_state = "awaycontent18"

/area/awaymission/avangarde17/inside/miner/mine
	name = "Шахта"
	icon_state = "awaycontent24"

/area/awaymission/avangarde17/inside/ruin
	name = "Руины"
	icon_state = "awaycontent19"

/area/awaymission/avangarde17/inside/kebab
	name = "Шаурмечная"
	icon_state = "awaycontent20"

/area/awaymission/avangarde17/inside/gov
	name = "Райком"
	icon_state = "awaycontent21"

/area/awaymission/avangarde17/inside/gov/radio
	name = "Райком - Радиостанция"
	icon_state = "awaycontent22"

/area/awaymission/avangarde17/inside/gov/second_floor
	name = "Райком - Второй Этаж"
	icon_state = "awaycontent23"

/area/awaymission/avangarde17/inside/police
	name = "Участковый Пункт Милиции"
	icon_state = "awaycontent1"

/area/awaymission/avangarde17/inside/police/armory
	name = "Участковый Пункт Милиции - Оружейная"
	icon_state = "awaycontent2"

/area/awaymission/avangarde17/inside/police/chief
	name = "Участковый Пункт Милиции - Кабинет Опера"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/police/cabinet
	name = "Участковый Пункт Милиции - Кабинеты"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/police/prison
	name = "Участковый Пункт Милиции - Обезьянник"
	icon_state = "awaycontent5"

/area/awaymission/avangarde17/inside/police/car
	name = "Участковый Пункт Милиции - Гараж"
	icon_state = "awaycontent6"

/area/awaymission/avangarde17/inside/police/second_floor
	name = "Участковый Пункт Милиции - Второй Этаж"
	icon_state = "awaycontent10"

/area/awaymission/avangarde17/inside/police/custodials
	name = "Участковый Пункт Милиции - Уборная"
	icon_state = "awaycontent8"

/area/awaymission/avangarde17/inside/hospital
	name = "Фельдшерско-Акушерский Пункт"
	icon_state = "awaycontent1"

/area/awaymission/avangarde17/inside/hospital/dr
	name = "Фельдшерско-Акушерский Пункт - Ординаторская"
	icon_state = "awaycontent2"

/area/awaymission/avangarde17/inside/hospital/hall
	name = "Фельдшерско-Акушерский Пункт - Приемник"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/hospital/morgue
	name = "Фельдшерско-Акушерский Пункт - Морг"
	icon_state = "awaycontent5"

/area/awaymission/avangarde17/inside/energy
	name = "Трансформаторная Будка"
	icon_state = "awaycontent5"

/area/awaymission/avangarde17/inside/garage
	name = "Тёмный Гараж"
	icon_state = "awaycontent1"

/area/awaymission/avangarde17/inside/toilet
	name = "Сельский Туалет"
	icon_state = "awaycontent1"

/area/awaymission/avangarde17/inside/old_hangar
	name = "Старый Ангар"
	icon_state = "awaycontent1"

/area/awaymission/avangarde17/inside/old_hangar/first_floor
	name = "Старый Ангар - Первый Этаж"
	icon_state = "awaycontent2"

/area/awaymission/avangarde17/inside/old_hangar/eng
	name = "Старый Ангар - Генераторная"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/old_hangar/second_floor
	name = "Старый Ангар - Второй Этаж"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/old_hangar/bedroom
	name = "Старый Ангар - Общага"
	icon_state = "awaycontent5"

// MARK: Военная база
/area/awaymission/avangarde17/inside/base
	name = "ГРК-4 - Военная База"
	icon_state = "awaycontent1"

/area/awaymission/avangarde17/inside/base_zampolit
	name = "ГРК-4 - Кабинет Замполита"
	icon_state = "awaycontent2"

/area/awaymission/avangarde17/inside/base_comendant
	name = "ГРК-4 - Кабинет Коменданта"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/base_briefroom
	name = "ГРК-4 - Зал Собраний"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/base_prapor
	name = "ГРК-4 - Коморка Прапора"
	icon_state = "awaycontent5"

/area/awaymission/avangarde17/inside/base_barracs
	name = "ГРК-4 - Казармы"
	icon_state = "awaycontent6"

/area/awaymission/avangarde17/inside/base_smokeroom
	name = "ГРК-4 - Курилка"
	icon_state = "awaycontent7"

/area/awaymission/avangarde17/inside/base_kitchen
	name = "ГРК-4 - Столовая"
	icon_state = "awaycontent8"

/area/awaymission/avangarde17/inside/base_hospital
	name = "ГРК-4 - Лазарет"
	icon_state = "awaycontent9"

/area/awaymission/avangarde17/inside/base_surgery
	name = "ГРК-4 - Операционная"
	icon_state = "awaycontent10"

/area/awaymission/avangarde17/inside/base_research
	name = "ГРК-4 - Научный Блок"
	icon_state = "awaycontent11"

/area/awaymission/avangarde17/inside/base_cargo
	name = "ГРК-4 - Пункт Досмотра"
	icon_state = "awaycontent12"

/area/awaymission/avangarde17/inside/base_hangar
	name = "ГРК-4 - Ангар"
	icon_state = "awaycontent13"

/area/awaymission/avangarde17/inside/base_controlroom
	name = "ГРК-4 - Диспетчерская"
	icon_state = "awaycontent14"

/area/awaymission/avangarde17/inside/base_mining
	name = "ГРК-4 - Шахтерский Ангар"
	icon_state = "awaycontent15"

/area/awaymission/avangarde17/inside/base_eng
	name = "ГРК-4 - Трансформаторная будка"
	icon_state = "awaycontent16"

/area/awaymission/avangarde17/inside/base_post1
	name = "ГРК-4 - Будка"
	icon_state = "awaycontent17"

/area/awaymission/avangarde17/inside/base_post2
	name = "ГРК-4 - Будка Досмотра"
	icon_state = "awaycontent18"

/area/awaymission/avangarde17/inside/base_garage
	name = "ГРК-4 - Гараж"
	icon_state = "awaycontent19"

// MARK: Дом 1 - Подъезд 1
/area/awaymission/avangarde17/inside/house_1
	name = "Советская 2 - Подъезд 1"
	icon_state = "awaycontent1"

/area/awaymission/avangarde17/inside/house_1/first_apartment
	name = "Этаж 1 - Квартира 1"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/house_1/first_apartment/bedroom
	name = "Спальня"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/house_1/first_apartment/bathroom
	name = "Туалет"
	icon_state = "awaycontent5"

/area/awaymission/avangarde17/inside/house_1/second_apartment
	name = "Этаж 1 - Квартира 2"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/house_1/second_apartment/first_bedroom
	name = "Спальня 1"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/house_1/second_apartment/second_bedroom
	name = "Спальня 2"
	icon_state = "awaycontent5"

/area/awaymission/avangarde17/inside/house_1/second_apartment/third_bedroom
	name = "Спальня 3"
	icon_state = "awaycontent6"

/area/awaymission/avangarde17/inside/house_1/second_apartment/bathroom
	name = "Туалет"
	icon_state = "awaycontent7"

/area/awaymission/avangarde17/inside/house_1/third_apartment
	name = "Этаж 2 - Квартира 1"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/house_1/third_apartment/bedroom
	name = "Спальня"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/house_1/third_apartment/bathroom
	name = "Туалет"
	icon_state = "awaycontent5"

/area/awaymission/avangarde17/inside/house_1/fourth_apartment
	name = "Этаж 2 - Квартира 2"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/house_1/fourth_apartment/bedroom
	name = "Спальня"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/house_1/fourth_apartment/bathroom
	name = "Туалет"
	icon_state = "awaycontent5"

/area/awaymission/avangarde17/inside/house_1/fifth_apartment
	name = "Этаж 2 - Квартира 3"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/house_1/fifth_apartment/bedroom
	name = "Спальня"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/house_1/fifth_apartment/bathroom
	name = "Туалет"
	icon_state = "awaycontent5"

// MARK: Дом 1 - Подъезд 2
/area/awaymission/avangarde17/inside/house_2
	name = "Советская 2 - Подъезд 2"
	icon_state = "awaycontent1"

/area/awaymission/avangarde17/inside/house_2/first_apartment
	name = "Этаж 1 - Квартира 1"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/house_2/first_apartment/bedroom
	name = "Спальня"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/house_2/first_apartment/bathroom
	name = "Туалет"
	icon_state = "awaycontent5"

/area/awaymission/avangarde17/inside/house_2/second_apartment
	name = "Этаж 1 - Квартира 2"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/house_2/second_apartment/first_bedroom
	name = "Спальня 1"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/house_2/second_apartment/second_bedroom
	name = "Спальня 2"
	icon_state = "awaycontent5"

/area/awaymission/avangarde17/inside/house_2/second_apartment/third_bedroom
	name = "Спальня 3"
	icon_state = "awaycontent6"

/area/awaymission/avangarde17/inside/house_2/second_apartment/bathroom
	name = "Туалет"
	icon_state = "awaycontent7"

/area/awaymission/avangarde17/inside/house_2/third_apartment
	name = "Этаж 2 - Квартира 1"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/house_2/third_apartment/bedroom
	name = "Спальня"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/house_2/third_apartment/bathroom
	name = "Туалет"
	icon_state = "awaycontent5"

/area/awaymission/avangarde17/inside/house_2/fourth_apartment
	name = "Этаж 2 - Квартира 2"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/house_2/fourth_apartment/bedroom
	name = "Спальня"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/house_2/fourth_apartment/bathroom
	name = "Туалет"
	icon_state = "awaycontent5"

/area/awaymission/avangarde17/inside/house_2/fifth_apartment
	name = "Этаж 2 - Квартира 3"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/house_2/fifth_apartment/bedroom
	name = "Спальня"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/house_2/fifth_apartment/bathroom
	name = "Туалет"
	icon_state = "awaycontent5"

// MARK: Дом 2 - Подъезд 1
/area/awaymission/avangarde17/inside/house_3
	name = "Ленина 1 - Подъезд 1"
	icon_state = "awaycontent1"

/area/awaymission/avangarde17/inside/house_3/first_apartment
	name = "Этаж 1 - Квартира 1"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/house_3/first_apartment/bedroom
	name = "Спальня"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/house_3/first_apartment/bathroom
	name = "Туалет"
	icon_state = "awaycontent5"

/area/awaymission/avangarde17/inside/house_3/second_apartment
	name = "Этаж 1 - Квартира 2"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/house_3/second_apartment/bedroom
	name = "Спальня"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/house_3/second_apartment/bathroom
	name = "Туалет"
	icon_state = "awaycontent7"

/area/awaymission/avangarde17/inside/house_3/third_apartment
	name = "Этаж 1 - Квартира 3"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/house_3/third_apartment/bedroom
	name = "Спальня"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/house_3/third_apartment/bathroom
	name = "Туалет"
	icon_state = "awaycontent7"

/area/awaymission/avangarde17/inside/house_3/fourth_apartment
	name = "Этаж 1 - Квартира 4"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/house_3/fourth_apartment/bedroom
	name = "Спальня"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/house_3/fourth_apartment/bathroom
	name = "Туалет"
	icon_state = "awaycontent7"

/area/awaymission/avangarde17/inside/house_3/fifth_apartment
	name = "Этаж 2 - Квартира 1"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/house_3/fifth_apartment/bedroom
	name = "Спальня"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/house_3/fifth_apartment/bathroom
	name = "Туалет"
	icon_state = "awaycontent5"

/area/awaymission/avangarde17/inside/house_3/six_apartment
	name = "Этаж 2 - Квартира 2"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/house_3/six_apartment/bedroom
	name = "Спальня"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/house_3/six_apartment/bathroom
	name = "Туалет"
	icon_state = "awaycontent5"

/area/awaymission/avangarde17/inside/house_3/seven_apartment
	name = "Этаж 2 - Квартира 3"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/house_3/seven_apartment/bedroom
	name = "Спальня"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/house_3/seven_apartment/bathroom
	name = "Туалет"
	icon_state = "awaycontent5"

/area/awaymission/avangarde17/inside/house_3/eighth_apartment
	name = "Этаж 2 - Квартира 4"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/house_3/eighth_apartment/bedroom
	name = "Спальня"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/house_3/eighth_apartment/bathroom
	name = "Туалет"
	icon_state = "awaycontent5"

// MARK: Дом 3 - Подъезд 1
/area/awaymission/avangarde17/inside/house_4
	name = "Ленина 1 - Подъезд 1"
	icon_state = "awaycontent1"

/area/awaymission/avangarde17/inside/house_4/first_apartment
	name = "Этаж 1 - Квартира 1"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/house_4/first_apartment/bedroom
	name = "Спальня"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/house_4/first_apartment/bathroom
	name = "Туалет"
	icon_state = "awaycontent5"

/area/awaymission/avangarde17/inside/house_4/second_apartment
	name = "Этаж 1 - Квартира 2"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/house_4/second_apartment/bedroom
	name = "Спальня"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/house_4/second_apartment/bathroom
	name = "Туалет"
	icon_state = "awaycontent7"

/area/awaymission/avangarde17/inside/house_4/third_apartment
	name = "Этаж 1 - Квартира 3"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/house_4/third_apartment/bedroom
	name = "Спальня"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/house_4/third_apartment/bathroom
	name = "Туалет"
	icon_state = "awaycontent7"

/area/awaymission/avangarde17/inside/house_4/fourth_apartment
	name = "Этаж 1 - Квартира 4"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/house_4/fourth_apartment/bedroom
	name = "Спальня"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/house_4/fourth_apartment/bathroom
	name = "Туалет"
	icon_state = "awaycontent7"

/area/awaymission/avangarde17/inside/house_4/fifth_apartment
	name = "Этаж 2 - Квартира 1"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/house_4/fifth_apartment/bedroom
	name = "Спальня"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/house_4/fifth_apartment/bathroom
	name = "Туалет"
	icon_state = "awaycontent5"

/area/awaymission/avangarde17/inside/house_4/six_apartment
	name = "Этаж 2 - Квартира 2"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/house_4/six_apartment/bedroom
	name = "Спальня"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/house_4/six_apartment/bathroom
	name = "Туалет"
	icon_state = "awaycontent5"

/area/awaymission/avangarde17/inside/house_4/seven_apartment
	name = "Этаж 2 - Квартира 3"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/house_4/seven_apartment/bedroom
	name = "Спальня"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/house_4/seven_apartment/bathroom
	name = "Туалет"
	icon_state = "awaycontent5"

/area/awaymission/avangarde17/inside/house_4/eighth_apartment
	name = "Этаж 2 - Квартира 4"
	icon_state = "awaycontent3"

/area/awaymission/avangarde17/inside/house_4/eighth_apartment/bedroom
	name = "Спальня"
	icon_state = "awaycontent4"

/area/awaymission/avangarde17/inside/house_4/eighth_apartment/bathroom
	name = "Туалет"
	icon_state = "awaycontent5"

/*
// Скорее всего удалить луп музыки, трансляция будет по радио
/area/awaymission/avangarde17/outside/base
	name = "Аванпост КССП"
	icon_state = "awaycontent3"
	var/sound_file = 'modular_bandastation/events/avangarde17/audio/red_army.ogg'
	var/sound_channel = 61
	var/max_volume = 20
	var/fade_tick = 0.3 SECONDS
	var/fade_duration = 1.5 SECONDS
	var/check_period = 3 SECONDS

	var/play_duration = 4 MINUTES + 40 SECONDS
	var/silence_duration = 20 SECONDS
	var/is_phase_play = FALSE

	var/list/current_volumes = list()
	var/list/target_volumes  = list()
	var/list/attached_mobs   = list()

/area/awaymission/avangarde17/inside
	name = "Аванпост КССП"
	icon_state = "awaycontent4"
	static_lighting = TRUE
	base_lighting_alpha = 0

/area/awaymission/avangarde17/inside/cave
	name = "Пещеры"
	icon_state = "awaycontent5"

/area/awaymission/avangarde17/inside/temple
	name = "Древний храм"
	icon_state = "awaycontent6"

/area/awaymission/avangarde17/outside/base/Initialize(mapload)
	. = ..()
	addtimer(CALLBACK(src, PROC_REF(update_members)), check_period, TIMER_LOOP | TIMER_STOPPABLE)
	addtimer(CALLBACK(src, PROC_REF(process_fades)),  fade_tick,   TIMER_LOOP | TIMER_STOPPABLE)
	start_cycle()

/area/awaymission/avangarde17/outside/base/Destroy()
	for(var/mob/M in attached_mobs)
		if(M?.client)
			SEND_SOUND(M, sound(null, channel = sound_channel))
	current_volumes.Cut()
	target_volumes.Cut()
	attached_mobs.Cut()
	return ..()

/area/awaymission/avangarde17/outside/base/proc/start_cycle()
	is_phase_play = TRUE
	for(var/mob/M in attached_mobs)
		if(!M?.client) continue
		var/sound/start = sound(sound_file)
		start.channel = sound_channel
		start.repeat = TRUE
		start.volume = current_volumes[M] || 0
		SEND_SOUND(M, start)
	update_members()
	addtimer(CALLBACK(src, PROC_REF(begin_silence_phase)), play_duration, TIMER_STOPPABLE)

/area/awaymission/avangarde17/outside/base/proc/begin_silence_phase()
	is_phase_play = FALSE
	for(var/mob/M in attached_mobs)
		target_volumes[M] = 0
	addtimer(CALLBACK(src, PROC_REF(start_cycle)), silence_duration, TIMER_STOPPABLE)

/area/awaymission/avangarde17/outside/base/proc/update_members()
	var/list/in_zone = list()
	for(var/mob/living/player in GLOB.player_list)
		if(!player?.client) continue
		if(get_area(player) == src)
			in_zone[player] = TRUE
			if(!(player in attached_mobs))
				var/sound/seed = sound(sound_file)
				seed.channel = sound_channel
				seed.repeat = TRUE
				seed.volume = 0
				SEND_SOUND(player, seed)
				attached_mobs += player
				current_volumes[player] = 0
			target_volumes[player] = is_phase_play ? max_volume : 0
	for(var/mob/existing in current_volumes.Copy())
		if(!existing?.client)
			detach_listener(existing)
		else if(!(existing in in_zone))
			target_volumes[existing] = 0

/area/awaymission/avangarde17/outside/base/proc/process_fades()
	for(var/mob/listener in current_volumes.Copy())
		if(!listener?.client)
			detach_listener(listener)
			continue
		var/cv = current_volumes[listener]
		var/tv = isnull(target_volumes[listener]) ? 0 : target_volumes[listener]
		if(cv == tv) continue
		var/step = round((max_volume * fade_tick) / max(0.1 SECONDS, fade_duration))
		if(step < 1) step = 1
		var/nv = cv
		if(cv < tv) nv = min(cv + step, tv)
		else        nv = max(cv - step, tv)
		if(abs(nv - cv) >= 2)
			var/sound/update = sound(null)
			update.channel = sound_channel
			update.repeat = TRUE
			update.volume = nv
			update.status = SOUND_UPDATE
			SEND_SOUND(listener, update)
		current_volumes[listener] = nv

/area/awaymission/avangarde17/outside/base/proc/detach_listener(mob/M)
	if(!M) return
	SEND_SOUND(M, sound(null, channel = sound_channel))
	current_volumes -= M
	target_volumes  -= M
	attached_mobs   -= M
*/
